{% extends "base.html" %} 
{% load static %} 

{% block title %}Investing Game{% endblock title %} 
{% block leftcontent %}
<div id="InstructionsDIV">
  <div id="Instructions3">
    <h3>
      Next, guess how much {{respondent}} will give back to you. You receive a
      bonus for a good guess â€“ if your guess is within $1 of the actual amount,
      you will earn an additional $2. How much do you think the {{respondent}}
      has decided to give back to you?
    </h3>
  </div>
</div>
{% endblock leftcontent %} 

{% block rightcontent %}
<div id="RightContentContainer">
  <form id="ReturnForm" action="{% url 'invest_game:respondent_investment' %}" method="post">
    {% csrf_token %}
    <input type="hidden" name="respondent_investment_guess" id="returned" value="0" />
    <input type="hidden" name="part" id="part" value="" />
  </form>

  <div id="UpperArrow">
    <img
      src="{% static 'games/media/Upper_Orange_Arrow.png' %}"
      alt="Upper Arrow"
      height="100%"
      width="100%"
    />
  </div>

  <div id="LowerArrow" style="display:none;">
    <img
      src="{% static 'games/media/Lower_Orange_Arrow.png' %}"
      alt="Lower Arrow"
      height="100%"
      width="100%"
    />
  </div>

  <div id="InvestmentCalc">
    <span id="InvestmentAmount">$0</span> X 3 =
    <span id="InvestmentResult">$0</span>
  </div>

  <div id="ReturnCalc" style="display:none;">
    <span id="ReturnAmount">$0</span>
  </div>

  {% include "_coins.html" with label="Investor" coins=investor_coins name="YOU" %}
  {% include "_coins.html" with label="Respondent" coins=respondent_coins name=respondent %}

  <div id="SliderContainer">
    <div id="parent" style="display: table; table-layout: fixed;">
      <div class="childwrap" style="display: table-row;">
        <div class="child" style="display: table-cell; width: calc(100% / 5)">
          |
        </div>
        <div class="child" style="display: table-cell; width: calc(100% / 5)">
          |
        </div>
        <div class="child" style="display: table-cell; width: calc(100% / 5)">
          |
        </div>
        <div class="child" style="display: table-cell; width: calc(100% / 5)">
          |
        </div>
        <div class="child" style="display: table-cell; width: calc(100% / 5)">
          |
        </div>
        <div class="child" style="display: table-cell; width: calc(100% / 5)">
          |
        </div>
      </div>
    </div>

    <div id="slider" style=" width: 100%"></div>
    <input
      style="top: 40px; left: 36%"
      type="submit"
      class="btn btn-lg btn-success"
      id="SliderSubmitBtn"
      value="Submit"
    />
  </div>
</div>
{% endblock rightcontent %} 

{% block jscontent %}
<!-- JavaScript code for this template -->
<script type="text/javascript">
  $(document).ready(function(){
      var invested = {{invested}}
      var returned = 0
      var ruler_num = invested * 3 + 5

      for (var i = 0; i <= ruler_num; i++) {
        var elm = '<div class="child" ' +
        'style="display: table-cell; width: calc(100% / ' + ruler_num +  ');">' + '|' +
        '</div>';
        $(elm).appendTo($(".childwrap2"))
      }

      invested = invested - 2;
      // returned = {{returned}}
      $("#UpperArrow").children("img")[0].src ="{% static 'games/media/Upper_Blue_Arrow.png' %}";
      $("#LowerArrow").show();
      $("#ReturnCalc").show();
      $("#InvestmentAmount").css("color", "blue");
      $("#InvestmentCalc").css("color", "blue");
      $("#InvestorCoinsAmountNum").css("color", "green");
      $("#Instructions1").slideUp();
      $("#Instructions2").show().slideDown();
      $("#PartNum").html(invested + 2);
      $("#InvestorPasses").html(invested);
      $("#YouReceivedFromInvestor").html(invested * 3);
      $("#InvestorIdentity").css("font-weight", "normal");
      $("#InvestorIdentityLabel").css("font-weight", "normal");
      $("#ResponderIdentity").css("font-weight", "bold");
      $("#ResponderIdentityLabel").css("font-weight", "bold");
      $("#RespondentCoinsAmount").css("color", "green");

      $( "#InvestmentAmount" ).html( "$" + invested );
      $( "#InvestmentResult" ).html( "$" + (invested * 3) );

      $("#returned").val( returned );
      $( "#ReturnAmount" ).html( "$" + returned );

      $( "#InvestorCoinsAmountNum" ).html( "$" + (5 - invested + returned) );
      $( "#RespondentCoinsAmountNum" ).html( "$" + (5 + (invested * 3) - returned) );

      $("#InvestorCoinsAmount").css("top", (76 - 9 * (returned - invested)) + "px");
      $("#RespondentCoinsAmount").css("top", (76 + 9 * (returned - (invested * 3))) + "px");

      var sliderMaxVal = 5 + (invested * 3);
      var sliderMinVal = 0;
      var sliderVal = sliderMaxVal - returned;

      for (i = 1; i <= 20; i++) {
        if (i <= sliderVal) {
          $("#RespondentCoin" + i).show();
        }
        else {
          $("#RespondentCoin" + i).hide();
        }
      }
      for (i = 1; i <= 20; i++) {
        if (i <= 5 - invested + returned) {
          $("#InvestorCoin" + i).show();
        }
        else {
          $("#InvestorCoin" + i).hide();
        }
      }

      $( "#slider" ).slider({
        value: sliderVal,
        min: sliderMinVal,
        max: sliderMaxVal,
        step: 1,
        slide: function( event, ui ) {
          invested = invested - 2;
          var inv = parseInt(ui.value);
          var transferedAmount = sliderMaxVal - inv;

          $("#returned").val(transferedAmount);
          $( "#ReturnAmount" ).html( "$" + transferedAmount );

          $( "#InvestorCoinsAmountNum" ).html( "$" + (5 - invested + transferedAmount) );
          $( "#RespondentCoinsAmountNum" ).html( "$" + inv );

          $("#InvestorCoinsAmount").css("top", (76 - 9 * (transferedAmount - invested)) + "px");
          $("#RespondentCoinsAmount").css("top", (76 + 9 * (transferedAmount - (invested * 3))) + "px");

          for (i = 1; i <= 20; i++) {
            if (i <= inv) {
              $("#RespondentCoin" + i).show();
            }
            else {
              $("#RespondentCoin" + i).hide();
            }
          }
          for (i = 1; i <= 20; i++) {
            if (i <= 5 - invested + transferedAmount) {
              $("#InvestorCoin" + i).show();
            }
            else {
              $("#InvestorCoin" + i).hide();
            }
          }

          invested = invested + 2;
        }
      });
      invested = invested + 2;

      $("#SliderSubmitBtn").click(function() {
          $("#ReturnForm").submit();
      });
  });
</script>
{% endblock jscontent %}
